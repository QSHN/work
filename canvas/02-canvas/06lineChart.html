<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>折线图</title>
</head>
<body>
    <script>
        /*
        * @constrctor { Function } 折线图类
        * @param { options: Object } 可配参数
        * @param { options.ctx: Context } 绘图上下文
        * @param { options.paddingTop: number } 坐标轴到画布上边的距离
        * @param { options.paddingRight: number } 坐标轴到画布右边的距离
        * @param { options.paddingBottom: number } 坐标轴到画布下边的距离
        * @param { options.paddingLeft: number } 坐标轴到画布左边的距离
        * @param { options.arrowWdith: number } 箭头宽度
        * @param { options.arrowHeight: number } 箭头高度
        * @param { options.pointR: number } 点的半径
        * @param { options.data: number } 数据
        * */
        function LineChart(options) {
            this.ctx = options.ctx;

            this.paddingTop = options.paddingTop || 30;
            this.paddingRight = options.paddingRight || 30;
            this.paddingBottom = options.paddingBottom || 30;
            this.paddingLeft = options.paddingLeft || 30;

            this.arrowWdith = options.arrowWdith || 15;
            this.arrowHeight = options.arrowHeight || 30;

            this.pointR = options.pointR || 4;
            this.data = options.data;

            // 该对象记录坐标轴中三个点的坐标
            this.vertex = {
                top: {
                    x: this.paddingLeft,
                    y: this.paddingTop
                },
                origin: {
                    x: this.paddingLeft,
                    y: this.ctx.canvas.height - this.paddingBottom
                },
                right: {
                    x: this.ctx.canvas.width - this.paddingRight,
                    y: this.ctx.canvas.height - this.paddingBottom
                }
            }
        }

        LineChart.prototype = {

            // 绘制整个折线图
            draw: function() {
                var point = this.getPoint();
                this.drawCoord();
                this.drawArrow();
                this.drawPoint(point);
                this.drawLine(point);
            },

            // 绘制坐标轴
            drawCoord: function() {
                this.ctx.beginPath();
                this.ctx.moveTo(this.vertex.top.x, this.vertex.top.y);
                this.ctx.lineTo(this.vertex.origin.x, this.vertex.origin.y);
                this.ctx.lineTo(this.vertex.right.x, this.vertex.right.y);
                this.ctx.stroke();
            },

            // 绘制箭头
            drawArrow: function() {
                this.ctx.beginPath();

                // 上箭头路径
                this.ctx.moveTo(this.vertex.top.x, this.vertex.top.y);
                this.ctx.lineTo(this.vertex.top.x - this.arrowWdith / 2, this.vertex.top.y + this.arrowHeight);
                this.ctx.lineTo(this.vertex.top.x, this.vertex.top.y + this.arrowHeight / 2);
                this.ctx.lineTo(this.vertex.top.x + this.arrowWdith / 2, this.vertex.top.y + this.arrowHeight);
                this.ctx.closePath();

                // 下箭头路径
                this.ctx.moveTo(this.vertex.right.x, this.vertex.right.y);
                this.ctx.lineTo(this.vertex.right.x - this.arrowHeight, this.vertex.right.y - this.arrowWdith / 2);
                this.ctx.lineTo(this.vertex.right.x - this.arrowHeight / 2, this.vertex.right.y);
                this.ctx.lineTo(this.vertex.right.x - this.arrowHeight, this.vertex.right.y + this.arrowWdith / 2);
                this.ctx.closePath();

                this.ctx.stroke();
            },

            /*
            * 把数据转换为坐标 ==> [{x,y}, {x,y}, {x,y}]
            * 该方法内部做了三件事件：
            * 1、通过数据的大小得到距离自定义坐标轴的高度
            * 2、通过数据的数量得到距离自定义坐标轴的宽度
            * 3、根据这些相对于自定义坐标轴的距离，求出相当于画布的距离
            * */
            getPoint: function() {
                var self = this;

                var coordWidth = this.vertex.right.x - this.vertex.origin.x - this.arrowHeight;
                var xRatio = coordWidth / this.data.length;

                var coordHeight = this.vertex.origin.y - this.vertex.top.y - this.arrowHeight;
                var yRatio = coordHeight / Math.max.apply(null, this.data);

                // 当前的this.data ==> [5, 10, 30, 60, 2]
                var point = this.data.map(function(val, i) {
                    return {
                        x: xRatio * (i + 1),    // xRitio是点与点之间的距离，乘以对应数据的下标，就得到对应数据占用宽度
                        y: yRatio * val         // yRitio是1个数据占用高度，乘以对应数据，就得到对应数据占用高度
                    }
                });

                // 把这些相当于自定义坐标轴的距离，转换为相对于画布的距离
                return point.map(function(obj, i) {
                    return {
                        x: self.vertex.origin.x + obj.x,
                        y: self.vertex.origin.y - obj.y
                    }
                });
            },

            // 绘制点
            drawPoint: function(point) {
                var self = this;
                point.forEach(function(obj, i) {
                    self.ctx.beginPath();
                    self.ctx.arc(obj.x, obj.y, self.pointR, 0, Math.PI*2);
                    self.ctx.fill();
                });
            },

            // 绘制折线
            drawLine: function(point) {
                var self = this;
                self.ctx.beginPath();
                point.forEach(function(obj, i) {
                    self.ctx.lineTo(obj.x, obj.y);
                });
                self.ctx.stroke();
            }
        }
    </script>

    <script>
        // 动态创建canvas，获取上下文
        var cvs = document.createElement('canvas');
        var ctx = cvs.getContext('2d');
        cvs.width = 600;
        cvs.height = 400;
        cvs.style.border = '1px solid red';
        document.body.appendChild(cvs);

        // 创建折线图实例，绘制
        var lineChart = new LineChart({ ctx: ctx, data: [2, 5, 8, 1, 3, 10] });
        lineChart.draw();

    </script>
</body>
</html>